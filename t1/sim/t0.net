*
* NGSPICE simulation script
* BJT amp with feedback
*

* forces current values to be saved
.options savecurrents

* supply voltage
Va 1 4 5.10355691205
* supply current
Id 8 6 1.0126488524
*dependent voltage source
Hvc 5 8 r6 8.24825537187k
*dependent current source
Gib 6 3 (2,5) 7.20092310025m 

*resistors
Rr1 2 1 1.03835624717k
Rr2 3 2 2.03980117275k
Rr3 2 5 3.02589288375k
Rr4 4 5 4.09496586064k
Rr5 5 6 3.11837790188k
Rr6 4 7 2.06517135248k
Rr7 7 8 1.01138577854k

* input voltage source
*Vin 1 0 0.0 ac 1.0 sin(0 .1 100k)

*Rs 1 2 1k

* input capacitor (DC block)
*Cb 2 base 1uF

*Rf coll base 50k

*Q1 coll base emit P2model

*Rc vcc coll 300

*Re emit 0 100

*Ce emit 0 10uF

.model P2model NPN(Bf=200, CJE=12pF, CJC=2pF)

.control

*makes plots in color
set hcopypscolor=0
set color0=white
set color1=black
set color2=red
set color3=blue
set color4=violet
set color5=rgb:3/8/0
set color6=rgb:4/0/0

op

echo "********************************************"
echo  "Operating point"
echo "********************************************"
print Vcc
print @Q1[ic]
print @Rf[i]

echo  "op_TAB"
print all
echo  "op_END"


echo "********************************************"
echo  "Transient analysis"
echo "********************************************"
tran 1e-5 10e-3

hardcopy trans.ps v(coll) v(base)
echo trans_FIG

echo "********************************************"
echo  "Frequency analysis"
echo "********************************************"

ac dec 10 10 100MEG

hardcopy acm.ps db(v(coll)) v(base)
echo acm_FIG
hardcopy acp.ps v(base)
echo acp_FIG

*plot db(v(coll))
*plot vp(coll)

echo "********************************************"
echo  "Input impedance"
echo "********************************************"

hardcopy zim.ps abs(v(coll)/((v(1)-v(2))/1k))
echo zim_FIG

quit
.endc

.end
